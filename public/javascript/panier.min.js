const counter=document.querySelector(".counter"),panierHolder=document.querySelector(".panier-item__holder"),totalPriceHTML=document.querySelector(".price__holder"),btnSubmit=document.querySelector(".btn-submit"),deleteHolder=document.querySelector(".delete__holder"),outerLoader=document.querySelector(".loader__outer");function setTotalItem(){let e=localStorage.getItem("totalItem");return counter.innerHTML=e,e}function getCountItemCart(){return JSON.parse(localStorage.getItem("countItemCart"))}function setTotalPrice(){return localStorage.getItem("totalPrice")}async function getAllcart(){return await JSON.parse(localStorage.getItem("paniers"))}function clearLocalSorage(){localStorage.removeItem("paniers"),localStorage.removeItem("totalItem"),localStorage.removeItem("totalPrice"),localStorage.removeItem("cameras")}function displayCart(e){null!==e&&(outerLoader.style.display="none",e.map(e=>{panierHolder.innerHTML+=`\n            <article class="cart__article">\n                <div class="flexbox">\n                    <div class="flexbox__image">\n                    <a href="./appareil.html?id=${e._id}">\n                        <img src=${e.imageUrl} alt=${e.description}>\n                    </a>\n                    </div>\n\n                    <div class="card__detail">\n                        <h3> ${e.name}</h3>\n                        <p class="card__detail-price">PRIX : $ ${e.price/100}</p>\n\n                    </div>\n                    <span class="trash__holder" title="Supprimer l'article" data-id="${e._id}">\n                        <i class="fas fa-trash-alt"></i>\n                    </span>\n\n                </div>\n            </article>\n            `,deleteHolder.innerHTML='<button class="delete-all-btn">Effacer le panier</button>',totalPriceHTML.innerHTML=`\n            <p class="total-price">Prix :  ${setTotalPrice()} Euros</p>\n            `})),e.length<=0&&(panierHolder.innerHTML="<h2 style='text-align:center;'>VOtre panier est vide !</h2>",deleteHolder.innerHTML="")}function deleteOne(){let e,t=JSON.parse(localStorage.getItem("paniers")),r=JSON.parse(localStorage.getItem("totalItem"));[...document.querySelectorAll(".trash__holder")].map(l=>{l.addEventListener("click",({target:a})=>{a.parentElement.parentElement.parentElement.remove(),e=t.find(e=>e._id===l.dataset.id);let n=JSON.parse(localStorage.getItem("totalPrice"));n-=e.price/100,localStorage.setItem("totalPrice",JSON.stringify(n)),totalPriceHTML.innerHTML=`<p class="total-price">PRIX : ${n}</p>`,t=t.filter(e=>e._id!==l.dataset.id),localStorage.setItem("paniers",JSON.stringify(t)),r=t.length,localStorage.setItem("totalItem",JSON.stringify(r)),counter.innerHTML=r,0===r&&(deleteHolder.remove(),totalPriceHTML.remove(),panierHolder.innerHTML="<h2>VOTRE PANIER EST VIDE !</h2>",panierHolder.style.textAlign="center",btnSubmit.disabled=!0,btnSubmit.style.cursor="not-allowed",clearLocalSorage())})})}function deleteAll(){const e=document.querySelector(".delete-all-btn");null!==e&&e.addEventListener("click",()=>{if(confirm("Etes-vous sur de vouloir effacer tout le panier")){clearLocalSorage(),panierHolder.innerHTML="<h2style='text-align = 'center''>VOTRE PANIER EST VIDE ! </h2>",totalPriceHTML.innerHTML="Redirection dans ...",deleteHolder.remove(),setTimeout(function(){return window.location.href="../../views/produits.html"},1500)}})}outerLoader.style.visibility="visible";const form=document.getElementById("form"),getTotalItems=localStorage.getItem("totalItem");async function handleSubmit(){const e=document.getElementById("firstName"),t=document.getElementById("lastName"),r=document.getElementById("address"),l=document.getElementById("city"),a=document.getElementById("email"),n=/^[\w_-\s]*$/,o=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(a.value),i=n.test(e.value),c=n.test(t.value),d=n.test(r.value),s=n.test(l.value);if(!i)return alert(" PrÃ©nom non valide !");if(!c)return alert(" Nom de famille non valide ! ");if(!d)return alert(" Adresse non valide ! ");if(!s)return alert(" Ville non valide ! ");if(!o)return alert("Email non Valide !");const m=JSON.parse(localStorage.getItem("paniers")),u={contact:{firstName:e.value,lastName:t.value,address:r.value,city:l.value,email:a.value},products:m},g=await fetch("http://127.0.0.1:3000/api/cameras/order",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(u)}),p=await g.json();localStorage.setItem("order",JSON.stringify(p)),clearLocalSorage(),window.location.href="../../views/confirmation.html"}0!==getTotalItems&&null!=getTotalItems||(btnSubmit.disabled=!0,btnSubmit.style.cursor="not-allowed"),document.addEventListener("DOMContentLoaded",()=>{getAllcart().then(e=>{displayCart(e),deleteAll(e),deleteOne()}),setTotalItem()}),form.addEventListener("submit",e=>{e.preventDefault(),handleSubmit()});